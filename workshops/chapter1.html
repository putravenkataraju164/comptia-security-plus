
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>Sec+ | Chapter 1</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="../pkg/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
  <script src="../gif/webcomponentsjs/webcomponents-loader.js"></script>
  <script src="../gif/gif-player.es5.js" defer async></script>
</head>
<body>
  <google-codelab-analytics gaid="UA-49880327-14"></google-codelab-analytics>
  <google-codelab codelab-gaid=""
                  id="re101"
                  title="Threats, Attacks & Vulnerabilites"
                  environment="web"
                  feedback-link="">
		
		 
      <google-codelab-step label="Introduction" duration="1">
        <p>The first domain in CompTIA’s Security + exam (SYO-501) covers threats, attacks and vulnerabilities. This domain contributes 21 percent of the exam score. The exam’s objectives are covered through knowledge, application and comprehension, and the exam has both multiple-choice and performance-based questions. The performance-based questions are designed to test the candidate’s ability to troubleshoot problems in a simulated environment.</p>
			<h2 is-upgraded>What you&#39;ll learn</h2>
			<p>You will be learning different types of security compromises, the types of actors involved, and the concepts of penetration testing and vulnerability scanning.</p>
			<h2 class="checklist" is-upgraded>The module covers the following sections</h2>
			<ul class="checklist">
			<li>Given a scenario, analyse indicators of compromise and determine the type of malware</li>
			<li>Compare and contrast types of attacks</li>
			<li>Explain threat actor types and attributes</li>
			<li>Explain penetration testing concepts</li>
			<li>Explain vulnerability scanning concepts</li>
			<li>Explain the impact associated with types of vulnerabilities</li>
			</ul>
			<h2 class="checklist" is-upgraded>Contents</h2>
			<ul class="checklist">
			<li>Types of Malware</li>
			<li>Understanding Attacks</li>
			<li>Understanding Attack Types</li>
			<li>Wireless Attacks</li>
			<li>Application Attacks</li>
			<li>Social Engineering Attacks</li>
			<li>Vulnerability Scanning and Penetration Testing</li>
			<li>Impact of Vulnerabilites</li>
			</ul>
		  </google-codelab-step>
		  <google-codelab-step label="Terminology" duration="1">
		   <h2 is-upgraded>Threat</h2>
		   <p>A threat is a possible danger that might exploit a vulnerability to breach security and therefore cause possible harm.</p>
		   <h2 is-upgraded>Attack</h2>
		   <p>An attack is any attempt to expose, alter, disable, destroy, steal or gain unauthorized access to or make unauthorized use of an asset.</p>
		   <h2 is-upgraded>Vulnerability</h2>
		   <p>A vulnerability is a weakness which can be exploited by a threat actor (attacker), to perform unauthorized actions within a computer system.</p>
		   <h2 is-upgraded>Exploit</h2>
		   <p>An exploit is a piece of code, data or a sequence of commands that takes advantage of a vulnerability to cause unintended or unanticipated behavior to a computer resource.</p>
		   <h2 is-upgraded>C.I.A Triad</h2>
		   <p>CIA triad is a model designed to guide policies for information security within an organization.</p>
		   <p>The elements of the triad are considered the three most crucial components of security.</p>
		   <p class="image-container"><img style="width: 610.00px" src="../chap1/cia-traid.png"></p>
		   <h2 is-upgraded>A.A.A.</h2>
		   <p></p>
		   
		 
		  </google-codelab-step>
		  <google-codelab-step label="Malware" duration="3">
        <h2 is-upgraded>Malware</h2>
		<p>&#34;Malware (malicious software) is any software intentionally designed to cause damage to a computer, server, client, or computer network&#34;</p>
		<h2 is-upgraded>Types of malware</h2>
		<ol>
		<li><b>Virus:</b> A computer virus is a type of computer program that, when executed, replicates itself by modifying other computer programs and inserting its own code.</li>
		<li><b>Worms:</b> A computer worm is a standalone malware computer program that replicates itself in order to spread to other computers using vulnerable computer network to spread itself</li>
		<li><b>Trojan Horses:</b> A Trojan horse or Trojan is a type of malware that is often disguised as legitimate software.</li>
		<li><b>Adware:</b> Malware that generates revenue for its developer by automatically generating online advertisements.</li>
		<li><b>Spyware:</b> Spyware is a software that aims to gather information about a person or organization, without their knowledge, and send such information to another entity without the consumer's consent</li>
		<li><b>Ransomware:</b> Ransomware is a type of malware from cryptovirology that threatens to publish the victim's data or perpetually block access to it unless a ransom is paid.</li>
		<li><b>Backdoor:</b> A backdoor is a malicious computer program used to provide the attacker with unauthorized remote access to a compromised PC by exploiting security vulnerabilities.</li>
		<li><b>Logic Bomb:</b> A logic bomb is a piece of code intentionally inserted into a software system that will set off a malicious function when specified conditions are met</li>
		<li><b>Rootkit:</b> A rootkit is a collection of computer software, typically malicious, designed to enable access to a computer or an area of its software that is not otherwise allowed and often masks its existence or the existence of other software.</li>
		<li><b>Botnets:</b> A botnet is a number of Internet-connected devices, each of which is running one or more bots. Botnets can be used to perform DDoS attack, steal data, send spam, and allows the attacker to access the device and its connection. The owner can control the botnet using command and control (C&C) via IRC, Twitter and Pear-to-Pear communication</li>
		</ol>
		<h2 is-upgraded>Prevention</h2>
		<ul>
		<li>Install an anti-virus/anti-malware software</li>
		<li>Turn on your firewall</li>
		<li>Ensure that all security updates and patches are installed </li>
		<li>Avoid suspicious links, emails and websites</li>
		<li>Review software carefully before downloading </li>
		</ul>
      </google-codelab-step>

      <google-codelab-step label="Advanced Malware" duration="1">
        <h2 is-upgraded>Polymorphic Malware</h2>
		<p>Malware that constantly changes its identifiable features in order to evade detection. Polymorphic techniques involve frequently changing identifiable characteristics like file names and types or encryption keys to make the malware unrecognizable to many detection techniques.</p>
     	<p>Polymorphism is used to evade pattern-matching detection relied on by security solutions like antivirus software. While certain characteristics of polymorphic malware change, its functional purpose remains the same.</p>
        <aside class="special"><p><strong>Example:</strong> A polymorphic virus will continue to spread and infect devices even if its signature changes to avoid detection. By changing characteristics to generate a new signature, signature-based detection solutions will not recognize the file as malicious. Even if the new signature is identified and added to antivirus solutions’ signature database, polymorphic malware can continue to change signatures and carry out attacks without being detected.</p>
		</aside>
		<h2 is-upgraded>Armored Malware</h2>
		<ul>
		<li>Prevent Reverse Engineering</li>
		<li>Obfuscated Assembly Code</li>
		<li>Blocking use of system debuggers</li>
		<li>Preventing use of sandboxing</li>
		</ul>
      </google-codelab-step>

      <google-codelab-step label="Threats" duration="3">
          <h2 is-upgraded>Threat</h2>
		  <p>Threat can refer to anything which can hamper the normal activity of a PC either via a malware or any hacking attack.</p>

      </google-codelab-step>

      <google-codelab-step label="X86 Assembly Language" duration="5">
        <p>The C programming is a high level language interpreted by the compiler that converts code into machine instructions called assembly language. By using a disassembler tool we can get the assembly language of a compiled C program.</p>
<p>The Intel 8086 and 8088 were the first CPUs to have an instruction set that is now commonly referred to as <strong>x86</strong>. Intel Architecture 32-bit (IA-32) sometimes also called i386 is the 32-bit version of the x86 instruction set architecture.</p>
<p>The x86 architecture is <strong>little-endian</strong>, meaning that multi-byte values are written least significant byte first.</p>
<p><strong>How we see it:</strong></p>
<pre><code>| A0 | A1 | A2 | A3 |</code></pre>
<p><strong>Stored as Little Endian</strong></p>
<pre><code>| A3 | A2 | A1 | A0 |</code></pre>
<h2 is-upgraded>Opcodes and Instructions</h2>
<p>Each Instruction represents opcodes (hex code) that tell the machine what to do next.</p>
<p>Three categories of instructions:</p>
<ul>
<li>Data Movement/Access</li>
<li>Arithmetic / Logic</li>
<li>Control-Flow</li>
</ul>
<h3 is-upgraded>Common Instructions</h3>
<ul>
<li><strong>mov, lea</strong> (data movement, data access)</li>
<li><strong>add, sub</strong> (arithmetic)</li>
<li><strong>or, and, xor</strong> (Logic)</li>
<li><strong>shr, shl</strong> (Logic)</li>
<li><strong>ror, rol</strong> (Logic)</li>
<li><strong>jmp, jne, jnz, jnb</strong> (Control Flow)</li>
<li><strong>push, pop, call, leave, enter, ret</strong> (Control Flow)</li>
</ul>
<p>Example below is moving value at 0xaaaaaaaa into ecx.</p>
<table>
<tr><td colspan="1" rowspan="1"><p><strong><code>Instruction</code></strong></p>
<p><code>mov ecx,[0xaaaaaaaa];</code></p>
</td><td colspan="1" rowspan="1"><p><strong><code>Opcode</code></strong></p>
<p><code>8B 0D AA AA AA AA</code></p>
</td></tr>
</table>
<h2 is-upgraded>Registers</h2>
<h3 is-upgraded>General-Purpose Registers<a href="https://en.wikibooks.org/wiki/X86_Assembly/X86_Architecture" target="_blank"> [1]</a></h3>
<table>
<tr><td colspan="1" rowspan="1"><p><strong>Register</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>Description</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><strong>EAX</strong></p>
</td><td colspan="1" rowspan="1"><p>Accumulator Register</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><strong>EBX</strong></p>
</td><td colspan="1" rowspan="1"><p>Base Register</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><strong>ECX</strong></p>
</td><td colspan="1" rowspan="1"><p>Counter Register</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><strong>EDX</strong></p>
</td><td colspan="1" rowspan="1"><p>Data Register</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><strong>ESI</strong></p>
</td><td colspan="1" rowspan="1"><p>Source Index</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><strong>EDI</strong></p>
</td><td colspan="1" rowspan="1"><p>Destination Index</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><strong>EBP</strong></p>
</td><td colspan="1" rowspan="1"><p>Base Pointer</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><strong>ESP</strong></p>
</td><td colspan="1" rowspan="1"><p>Stack Pointer</p>
</td></tr>
</table>
<h3 is-upgraded>Instruction Pointer</h3>
<p>The <strong>EIP</strong> register contains the address of the next instruction to be executed.</p>
<h3 is-upgraded>Segment Registers</h3>
<table>
<tr><td colspan="1" rowspan="1"><p><strong>Register</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>Description</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>SS</p>
</td><td colspan="1" rowspan="1"><p>Stack Segment, Pointer to the stack</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>CS</p>
</td><td colspan="1" rowspan="1"><p>Code Segment, Pointer to the code</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>DS</p>
</td><td colspan="1" rowspan="1"><p>Data Segment, Pointer to the data</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>ES</p>
</td><td colspan="1" rowspan="1"><p>Extra Segment, Pointer to extra data</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>FS</p>
</td><td colspan="1" rowspan="1"><p>F Segment, Pointer to more extra data</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>GS</p>
</td><td colspan="1" rowspan="1"><p>G Segment, Pointer to still more extra data</p>
</td></tr>
</table>
<h3 is-upgraded>EFLAGS Registers</h3>
<table>
<tr><td colspan="1" rowspan="1"><p><strong>ID</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>Name</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>Description</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>CF</p>
</td><td colspan="1" rowspan="1"><p>Carry Flag</p>
</td><td colspan="1" rowspan="1"><p>Set if the last arithmetic operation carried (addition) or borrowed (subtraction) a bit beyond the size of the register. This is then checked when the operation is followed with an add-with-carry or subtract-with-borrow to deal with values too large for just one register to contain</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>PF</p>
</td><td colspan="1" rowspan="1"><p>Parity Flag</p>
</td><td colspan="1" rowspan="1"><p>Set if the number of set bits in the least significant byte is a multiple of 2</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>AF</p>
</td><td colspan="1" rowspan="1"><p>Adjust Flag</p>
</td><td colspan="1" rowspan="1"><p>Carry of Binary Code Decimal (BCD) numbers arithmetic operations</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>ZF</p>
</td><td colspan="1" rowspan="1"><p>Zero Flag</p>
</td><td colspan="1" rowspan="1"><p>Set if the result of an operation is Zero (0)</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>SF</p>
</td><td colspan="1" rowspan="1"><p>Sign Flag</p>
</td><td colspan="1" rowspan="1"><p>Set if the result of an operation is negative</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>TF</p>
</td><td colspan="1" rowspan="1"><p>Trap Flag</p>
</td><td colspan="1" rowspan="1"><p>Set if step by step debugging</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>IF</p>
</td><td colspan="1" rowspan="1"><p>Interruption Flag</p>
</td><td colspan="1" rowspan="1"><p>Set if interrupts are enabled</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>DF</p>
</td><td colspan="1" rowspan="1"><p>Direction Flag</p>
</td><td colspan="1" rowspan="1"><p>Stream direction. If set, string operations will decrement their pointer rather than incrementing it, reading memory backwards</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>OF</p>
</td><td colspan="1" rowspan="1"><p>Overflow Flag</p>
</td><td colspan="1" rowspan="1"><p>Set if signed arithmetic operations result in a value too large for the register to contain</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>IOPL</p>
</td><td colspan="1" rowspan="1"><p>I/O Privilege Level field (2 bits)</p>
</td><td colspan="1" rowspan="1"><p>I/O Privilege Level of the current process</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>NT</p>
</td><td colspan="1" rowspan="1"><p>Nested Task flag</p>
</td><td colspan="1" rowspan="1"><p>Controls chaining of interrupts. Set if the current process is linked to the next process</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>RF</p>
</td><td colspan="1" rowspan="1"><p>Resume Flag</p>
</td><td colspan="1" rowspan="1"><p>Response to debug exceptions</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>VM</p>
</td><td colspan="1" rowspan="1"><p>Virtual-8086 Mode</p>
</td><td colspan="1" rowspan="1"><p>Set if in 8086 compatibility mode</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>AC</p>
</td><td colspan="1" rowspan="1"><p>Alignment Check</p>
</td><td colspan="1" rowspan="1"><p>Set if alignment checking of memory references is done</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>VIF</p>
</td><td colspan="1" rowspan="1"><p>Virtual Interrupt Flag</p>
</td><td colspan="1" rowspan="1"><p>Virtual image of IF</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>VIP</p>
</td><td colspan="1" rowspan="1"><p>Virtual Interrupt Pending flag</p>
</td><td colspan="1" rowspan="1"><p>Set if an interrupt is pending</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>ID</p>
</td><td colspan="1" rowspan="1"><p>Identification Flag</p>
</td><td colspan="1" rowspan="1"><p>Support for CPUID instruction if can be set</p>
</td></tr>
</table>
<h2 is-upgraded>Hello World</h2>
<p class="image-container"><gif-player src="../re101/img/dc346360cad65528.gif" size="auto" repeat style="width:610px;height:371px" speed="1" play></gif-player></p>
<h2 is-upgraded>Calling a Function</h2>
<p>Arguments on the Stack</p>
<p class="image-container"><gif-player src="../re101/img/cb198c5ead29600.gif" size="auto" repeat style="width:610px;height:371px" speed="1" play></gif-player></p>

<h2 is-upgraded>Local Variables on the Stack</h2>
<p class="image-container"><gif-player src="../re101/img/491b385a0d25222c.gif" size="auto" repeat style="width:610px;height:371px" speed="1" play></gif-player></p>



      </google-codelab-step>

      <google-codelab-step label="Typical Attack Flow" duration="5">
        <p class="image-container"><img style="width: 610.00px" src="../re101/img/8e13a162d4f6dc62.png"></p>
<h2 is-upgraded>Malware Classes</h2>
<table>
<tr><td colspan="1" rowspan="1"><p><strong>Class</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>Description</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><strong>Virus</strong></p>
</td><td colspan="1" rowspan="1"><p>Code that propagates (replicates) across systems with user intervention</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><strong>Worm</strong></p>
</td><td colspan="1" rowspan="1"><p>Code that self-propagates/replicates across systems without requiring user intervention</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><strong>Bot</strong></p>
</td><td colspan="1" rowspan="1"><p>Automated process that interacts with other network services</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><strong>Trojan</strong></p>
</td><td colspan="1" rowspan="1"><p>Malware that is often disguised as legitimate software</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><strong>Ransomware</strong></p>
</td><td colspan="1" rowspan="1"><p>Malware that holds the victim&#39;s data hostage by cryptography or other means</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><strong>Rootkit</strong></p>
</td><td colspan="1" rowspan="1"><p>Masks its existence or the existence of other software</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><strong>Backdoor</strong></p>
</td><td colspan="1" rowspan="1"><p>Enables a remote attacker to have access to or send commands to a compromised computer</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><strong>RAT</strong></p>
</td><td colspan="1" rowspan="1"><p>Remote Access Trojan, similar to a backdoor</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><strong>Info Stealer</strong></p>
</td><td colspan="1" rowspan="1"><p>Steals victims information, passwords, or other personal data</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><strong>HackTool</strong></p>
</td><td colspan="1" rowspan="1"><p>Admin tools or programs that may be used by hackers to attack computer systems and networks. These programs are not generally malicious</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><strong>Hoax</strong></p>
</td><td colspan="1" rowspan="1"><p>Program may deliver a false warning about a computer virus or install a fake AV</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><strong>Dropper/Downloader</strong></p>
</td><td colspan="1" rowspan="1"><p>Designed to &#34;install&#34; or download some sort of malware</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><strong>Adware</strong></p>
</td><td colspan="1" rowspan="1"><p>Automatically renders advertisements in order to generate revenue for its author.</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><strong>PUP/PUA</strong></p>
</td><td colspan="1" rowspan="1"><p>Potentially Unwanted Program, sometimes added to a system without the user&#39;s knowledge or approval</p>
</td></tr>
</table>
<h2 is-upgraded>Malware Techniques</h2>
<p>The malware classes may exhibit one or more of the following techniques.<a href="https://attack.mitre.org/wiki/Main_Page" target="_blank">Mitre Att&amp;ck</a> framework provides a great reference for many of these techniques.</p>
<h3 is-upgraded>Compression</h3>
<p>Combining the compressed data with decompression code into a single executable</p>
<ul>
<li>Runtime packers</li>
<li>Self extractive archives</li>
</ul>
<h4 is-upgraded>List of packers</h4>
<table>
<tr><td colspan="1" rowspan="1"><ul>
<li><a href="http://www.oreans.com/themida.php" target="_blank">Themida</a></li>
<li><a href="http://www.siliconrealms.com/armadillo.php" target="_blank">Armadillo</a></li>
<li><a href="http://www.aspack.com/aspack.html" target="_blank">ASPack</a></li>
<li><a href="http://www.aspack.com/asprotect32.html" target="_blank">ASPR (ASProtect)</a></li>
<li><a href="http://www.boxedapp.com/boxedapppacker" target="_blank">BoxedApp Packer</a></li>
<li><a href="http://www.scottlu.com/Content/CExe.html" target="_blank">CExe</a></li>
<li><a href="http://www.dotbundle.com/" target="_blank">dotBundle</a></li>
<li><a href="http://www.enigmaprotector.com/" target="_blank">Enigma Protector</a></li>
<li><a href="http://www.webtoolmaster.com/exebundle.htm" target="_blank">EXE Bundle</a></li>
<li><a href="http://www.webtoolmaster.com/exestealth.htm" target="_blank">EXE Stealth</a></li>
<li><a href="http://www.cgsoftlabs.ro/express.html" target="_blank">eXPressor</a></li>
<li><a href="http://xtreeme.prv.pl/" target="_blank">FSG</a></li>
</ul>
</td><td colspan="1" rowspan="1"><ul>
<li><a href="http://www.farbrausch.de/~fg/kkrunchy/" target="_blank">kkrunchy</a></li>
<li><a href="https://web.archive.org/web/20070831063728/http://northfox.uw.hu/index.php?lang=eng&id=dev" target="_blank">MEW</a></li>
<li><a href="http://www.matcode.com/mpress.htm" target="_blank">MPRESS</a></li>
<li><a href="http://www.obsidium.de/" target="_blank">Obsidium</a></li>
<li><a href="http://pespin.w.interia.pl/" target="_blank">PESpin</a></li>
<li><a href="http://www.un4seen.com/petite" target="_blank">Petite</a></li>
<li><a href="http://www.softpedia.com/get/Programming/Packers-Crypters-Protectors/RLPack-Basic-Edition.shtml" target="_blank">RLPack Basic</a></li>
<li><a href="http://www.smartpacker.nl/" target="_blank">Smart Packer Pro</a></li>
<li><a href="http://www.oreans.com/themida.php" target="_blank">Themida</a></li>
<li><a href="https://upx.github.io/" target="_blank">UPX</a></li>
<li><a href="http://vmpsoft.com/products/vmprotect" target="_blank">VMProtect</a></li>
<li><a href="http://soft-lab.de/JoKo" target="_blank">XComp/XPack</a></li>
</ul>
</td></tr>
</table>
<h3 is-upgraded>Obfuscation</h3>
<ul>
<li>Deliberate act of creating obfuscated code that is difficult for humans to understand</li>
<li>Plain text strings will appear as base64 or Xor</li>
<li>Malicious behavior will include junk functions or routines that do nothing to throw off the reverser.</li>
<li>Control-Flow Flattening</li>
<li>String Encryption</li>
</ul>
<p class="image-container"><img style="width: 610.00px" src="../re101/img/41ff3f4dfedd3076.gif"></p>
<p><strong>Sample &amp; Link:</strong><a href="https://www.virustotal.com/en/file/f4d9660502220c22e367e084c7f5647c21ad4821d8c41ce68e1ac89975175051/analysis/" target="_blank"><strong>virustotal</strong></a></p>
<p>f4d9660502220c22e367e084c7f5647c21ad4821d8c41ce68e1ac89975175051 </p>
<h3 is-upgraded>Persistence</h3>
<ul>
<li>Once malware gains access to a system, it often looks to be there for a long time.</li>
<li>If the persistence mechanism is unique enough, it can even serve as a great way to identify a given piece of malware.</li>
</ul>
<p class="image-container"><img style="width: 610.00px" src="../re101/img/5ca07accd7bc2176.png"></p>

<p><strong>Sample &amp; Link: </strong><a href="https://www.virustotal.com/en/file/cb07ec66c37f43512f140cd470912281f12d1bc9297e59c96134063f963d07ff/analysis/" target="_blank"><strong>virustotal</strong></a></p>
<p>cb07ec66c37f43512f140cd470912281f12d1bc9297e59c96134063f963d07ff </p>
<h3 is-upgraded>Privilege Escalation</h3>
<ul>
<li>Exploiting a bug, design flaw or configuration oversight in an operating system or software application to gain elevated access to resources that are normally protected from an application or user.</li>
<li>Common Techniques:</li>
<li>Dll Search Order Hijacking</li>
<li>Dll injection</li>
<li>Exploiting a vulnerability</li>
<li>BufferOverflow</li>
<li>StackOverflow</li>
<li>Heapspray</li>
<li>Return Orientated Programming (ROP)</li>
<li>Credential Theft</li>
<li>UAC Bypasses</li>
</ul>
<h3 is-upgraded>Defense Evasion</h3>
<ul>
<li>Evading detection or avoiding defenses.</li>
<li>Common Techniques:</li>
<li>Killing AV</li>
<li>Deleting itself after a run</li>
<li>Timebombs/Timestomping</li>
<li>Stolen Certificates</li>
<li>Dll Side Loading</li>
<li>Masquerading</li>
<li>Process Hollowing</li>
<li>Code Injection</li>
</ul>
<h3 is-upgraded>Credential Theft</h3>
<ul>
<li>Going after password storage</li>
<li>Keylogging passwords</li>
<li>Screenshots</li>
</ul>
<h3 is-upgraded>Reconnaissance</h3>
<ul>
<li>Gain knowledge about the system and internal network.</li>
</ul>
<h3 is-upgraded>Lateral Movement</h3>
<ul>
<li>Enable an adversary to access and control remote systems on a network</li>
</ul>
<h2 is-upgraded><strong>Execution</strong></h2>
<ul>
<li>Techniques that result in execution of adversary-controlled code on a local or remote system</li>
<li>scripts</li>
<li>post-exploitation</li>
</ul>
<h2 is-upgraded><strong>Collection</strong></h2>
<ul>
<li>Identify and gather information, such as sensitive files, from a target network prior to exfiltration</li>
</ul>
<h2 is-upgraded><strong>Exfiltration</strong></h2>
<ul>
<li>Removing files and information</li>
</ul>
<h2 is-upgraded><strong>Command and Control</strong></h2>
<ul>
<li>Communicate with systems under their control</li>
</ul>


      </google-codelab-step>

      <google-codelab-step label="Reverse Engineering (RE) Tools" duration="5">
        <h2 is-upgraded><strong>Disassemblers</strong></h2>
<ul>
<li><a href="https://www.hex-rays.com/products/ida/" target="_blank">Ida</a></li>
<li>Free (Used in this workshop)</li>
<li>Pro (Most Popular)</li>
<li><a href="https://www.radare.org/" target="_blank">Radare</a></li>
<li><a href="http://www.capstone-engine.org/" target="_blank">Capstone</a></li>
</ul>
<h2 is-upgraded><strong>Debuggers</strong></h2>
<ul>
<li><a href="http://x64dbg.com/" target="_blank">x64dbg</a> (Used in this workshop)</li>
<li><a href="https://www.immunityinc.com/products/debugger/" target="_blank">Immunity</a></li>
<li><a href="http://www.ollydbg.de/" target="_blank">OllyDbg</a> (Most Popular)</li>
<li><a href="https://developer.microsoft.com/en-us/windows/hardware/windows-driver-kit" target="_blank">WinDbg</a></li>
</ul>
<h2 is-upgraded><strong>Decompilers</strong></h2>
<ul>
<li><a href="https://derevenets.com/" target="_blank">Snowman</a> (Integrated with x64dbg)</li>
<li><a href="https://www.jetbrains.com/decompiler/" target="_blank">dotPeek</a> .NET decompiler</li>
</ul>
<h2 is-upgraded><strong>Information Gathering</strong></h2>
<ul>
<li><a href="http://www.ntcore.com/exsuite.php" target="_blank">CFF Explorer</a> - PE header parser (Used in this workshop)</li>
<li><a href="http://www.heaventools.com/overview.htm" target="_blank">PE Explorer</a> - PE inspection tool (Used in this workshop)</li>
<li><a href="https://www.mcafee.com/hk/downloads/free-tools/bintext.aspx" target="_blank">BinText</a> - Extract string from a binary</li>
<li><a href="https://technet.microsoft.com/en-us/sysinternals/bb842062.aspx" target="_blank">Sysinternals Suite</a> (Used in this workshop)</li>
<li>procmon</li>
<li>procexplorer</li>
<li><a href="http://www.inetsim.org/downloads.html" target="_blank">InetSim: Internet Services Simulation Suite</a> (Used in this workshop)</li>
<li><a href="https://virustotal.github.io/yara/" target="_blank">Yara: pattern matching rule engine</a></li>
<li><a href="https://www.wireshark.org/download.html" target="_blank">Wireshark</a> - network sniffing (Used in this workshop)</li>
<li><a href="http://www.rohitab.com/downloads" target="_blank">API Monitor</a></li>
</ul>
<h2 is-upgraded><strong>Helpful Websites</strong></h2>
<ul>
<li><a href="https://www.virustotal.com/" target="_blank">virustotal.com</a> - free service that analyzes suspicious files and URLs</li>
<li><a href="https://malwr.com/" target="_blank">malwr.com</a> - Malwr is a free malware analysis service</li>
<li><a href="https://www.hybrid-analysis.com/" target="_blank">hyrbid-analysis</a> - free malware analysis service</li>
<li><a href="http://whois.domaintools.com/" target="_blank">whois.domaintools.com</a> - look up domains</li>
<li><a href="https://www.robtex.com/" target="_blank">robtex.com</a> - free DNS lookup tool</li>
<li><a href="https://www.debuggex.com/" target="_blank">www.debuggex.com</a> - Online Visual Regex Tester</li>
</ul>
<h2 is-upgraded><strong>Support</strong></h2>
<ul>
<li><a href="https://mh-nexus.de/en/hxd/" target="_blank">HxD Hex Editor</a> (Used in this workshop)</li>
<li><a href="https://www.python.org/downloads/" target="_blank">Python</a> - used for automating tasks</li>
</ul>
<h2 is-upgraded><strong>Tools Used in the Workshop</strong></h2>
<h3 is-upgraded><strong>Disassembler: IdaFree</strong></h3>
<ul>
<li><strong>Visual Modes</strong></li>
<li><strong>Graph Mode</strong> - control flow diagram</li>
<li><strong>Text Mode</strong> - default view of disassembled code</li>
<li><strong>Command Cheatsheet</strong></li>
<li>Please refer to this<a href="idacheatsheet.html" target="_blank">Ida cheatsheet</a></li>
<li><strong>Common Commands</strong></li>
</ul>
<table>
<tr><td colspan="1" rowspan="1"><p><strong>Action</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>Command</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Jump to xref to operand</p>
</td><td colspan="1" rowspan="1"><p>X</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Jump to address</p>
</td><td colspan="1" rowspan="1"><p>G</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Enter comment</p>
</td><td colspan="1" rowspan="1"><p>Shift+;</p>
</td></tr>
</table>
<p class="image-container"><img style="width: 610.00px" src="../re101/img/6e56c36583596a5d.gif"></p>

<h3 is-upgraded><strong>Debugger: x64dbg</strong></h3>
<p><strong>Common Commands</strong></p>
<table>
<tr><td colspan="1" rowspan="1"><p><strong>Action</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>Command</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Enter comment</p>
</td><td colspan="1" rowspan="1"><p>;</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>BreakPoint</p>
</td><td colspan="1" rowspan="1"><p>F2</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Step into</p>
</td><td colspan="1" rowspan="1"><p>F7</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Step over</p>
</td><td colspan="1" rowspan="1"><p>F8</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Run</p>
</td><td colspan="1" rowspan="1"><p>F9</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Edit Instruction</p>
</td><td colspan="1" rowspan="1"><p>Space</p>
</td></tr>
</table>
<p class="image-container"><gif-player src="../re101/img/fa21c1bdf4077bf.gif" size="auto" repeat style="width:610px;height:371px" speed="1" play></gif-player></p>

<h3 is-upgraded>Keyboard Layout for IdaFree and x64dbg</h3>
<p class="image-container"><gif-player src="../re101/img/7e2c7d236692cc4d.gif" size="auto" repeat style="width:610px;height:371px" speed="1" play></gif-player></p>

<h3 is-upgraded><strong>Information Gathering: PE Bear</strong></h3>
<ul>
<li>Parses the PE headers</li>
<li>Explores Resources</li>
<li>Unpacks UPX</li>
</ul>
<p class="image-container"><img style="width: 610.00px" src="../re101/img/d9edb3f329d60c01.jpeg"></p>
<h3 is-upgraded><strong>Information Gathering: Sysinternals Suite</strong></h3>
<ul>
<li>advanced system utilities</li>
<li><strong>ProcMon</strong> - Monitor processes/thread, files system, network, and registry activity on the system</li>
<li><strong>ProcExp</strong> - Monitor processes running on the system</li>
</ul>
<p class="image-container"><img style="width: 610.00px" src="../re101/img/7bd1f3fd3308311c.png"></p>


      </google-codelab-step>

      <google-codelab-step label="LAB 1: Intro" duration="2">
        <aside class="warning"><p>Download the binary for this Lab: <a href="https://drive.google.com/file/d/1sQFvOlpqiZNTOgGSEDTXHACCmO2gBQXC/view?usp=sharing" target="_blank"><paper-button class="colored" raised><iron-icon icon="file-download"></iron-icon>Download Unknown_RE1012018.zip</paper-button></a></p>
<p>password: re1012018</p>
</aside>
<p>Depending on your workload, you want to spend the least amount of time trying to determine what the malware is doing and how to get rid of it. Many malware analysts use their own triage analysis, similar to that in the Emergency Room at the hospital.</p>
<p>You will want to quickly narrow down specific information and indicators before moving on to deeper static and dynamic analysis.</p>
<p>This checklist should get you started:</p>
<ul>
<li>File Context and Delivery</li>
<li>File Information &amp; Header Analysis</li>
<li>Get Basic PE information</li>
<li>Simple Search</li>
<li>Collect Strings</li>
<li>Check AV vendors</li>
<li>Quick VM Detonation</li>
<li>Capture network information</li>
</ul>
<h3 is-upgraded><strong>File Context and Delivery</strong></h3>
<p>When you receive the malware binary, it&#39;s important to ask how the malware got there in the first place.</p>
<p>Questions to ask:</p>
<ul>
<li>Did it come from an email?</li>
<li>Did it come from a browser download?</li>
<li>Was it quarantined in an Anti-Virus?</li>
<li>Is it an anomalous process running?</li>
</ul>
<h3 is-upgraded><strong>File Information &amp; Header Analysis</strong></h3>
<ul>
<li>Use a <strong>file</strong> command (sniffer VM) to determine the file type</li>
<li>Verify the file header using a hex editor (HxD)</li>
</ul>
<h3 is-upgraded><strong>Get Basic PE information</strong></h3>
<ul>
<li>Parse the PE header using the tool PE Bear</li>
<li>Determine what resources, DLL imports, and libraries used</li>
<li>Example: If you see <strong>Ws2_32.dll</strong> it might be setting up a network connection because it&#39;s used for setting up sockets</li>
</ul>
<h3 is-upgraded><strong>Simple Search</strong></h3>
<ul>
<li>Calculate the hash of the file and check the web to see if it&#39;s been seen already</li>
</ul>
<h3 is-upgraded><strong>Collect Strings</strong></h3>
<ul>
<li>Using the string command in linux or BinText tool, extract the strings to find any clues</li>
</ul>
<h3 is-upgraded><strong>Check AV vendors</strong></h3>
<ul>
<li>Run the file against an Anti-Virus or VirusTotal to see if there are any detections</li>
</ul>
<h3 is-upgraded><strong>Quick VM Detonation</strong></h3>
<ul>
<li>Use open source VM detonation services like hybrid-analysis.com or malwr.com to get the behavior quickly</li>
</ul>
<h3 is-upgraded><strong>Capture network information</strong></h3>
<ul>
<li>Use the VM detonation service to capture any network connections or packet data.</li>
<li>If you can&#39;t do this then we will need to dynamically debug the malware.</li>
</ul>


      </google-codelab-step>

      <google-codelab-step label="Lab 1: Triage Analysis" duration="25">
        <h2 is-upgraded>Start the Victim VM</h2>
<p>Copy over the Unknown binary file to the Victim VM&#39;s Desktop</p>
<h2 is-upgraded>Check the file header </h2>
<p>Open the file in the hex editor <strong>HxD</strong></p>
<p>Notice the first 2 bytes are <strong>MZ </strong>meaning it&#39;s a PE Binary </p>
<pre><code>00000000: 4d5a 9000 0300 0000 0400 0000 ffff 0000  MZ..............
00000010: b800 0000 0000 0000 4000 0000 0000 0000  ........@.......
00000020: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00000030: 0000 0000 0000 0000 0000 0000 d800 0000  ................
00000040: 0e1f ba0e 00b4 09cd 21b8 014c cd21 5468  ........!..L.!Th
00000050: 6973 2070 726f 6772 616d 2063 616e 6e6f  is program canno
00000060: 7420 6265 2072 756e 2069 6e20 444f 5320  t be run in DOS
00000070: 6d6f 6465 2e0d 0d0a 2400 0000 0000 0000  mode....$.......
00000080: e34b 539a a72a 3dc9 a72a 3dc9 a72a 3dc9  .KS..*=..*=..*=.
00000090: bcb7 a3c9 a62a 3dc9 bcb7 97c9 a12a 3dc9  .....*=......*=.</code></pre>
<h2 is-upgraded>Check the PE header information</h2>
<p>Add the file extension <strong>.exe</strong> to the <strong>Unknown</strong> file so that it reads as <strong>Unknown.exe</strong>. Load the file in <strong>PE Bear </strong> to check the PE header information.</p>
<ul>
<li>Select the Import Directory in the navigation tree</li>
<li>Notice that is using<a href="https://docs.microsoft.com/en-us/windows/desktop/api/winbase/nf-winbase-findresourcea" target="_blank"><strong>FindResourceA</strong></a> and<a href="https://docs.microsoft.com/en-us/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessa" target="_blank"><strong>CreateProcessA</strong></a>. This means the executable might be extracting something out of the resource section and run it as a new process.</li>
</ul>
<p class="image-container"><img style="width: 618.23px" src="../re101/img/a2b4b71471737f79.png"></p>
<h2 is-upgraded>Collect the MD5 hash</h2>
<p>Select the File information in the PE Bear navigation tree to collect the MD5 hash and SHA1 Hash.</p>
<p>Go to<a href="http://virustotal.com" target="_blank">virustotal.com</a> and search based on hash. See if there are any search results.</p>
<h2 is-upgraded>Open the file in <strong>BinText</strong></h2>
<p>Next open the file in <strong>BinText</strong> program and note any interesting strings.</p>
<p class="image-container"><img style="width: 610.00px" src="../re101/img/9d68c4d80e46c7e1.png"></p>
<h3 is-upgraded><strong>Quick Detonation</strong></h3>
<p>The point of the quick detonation is to capture the filesystem, registry, and connection activity. The VMs are set up in such a way that the Victim VM&#39;s internet traffic is captured by the Sniffer VM.</p>
<ul>
<li>Besure you are running both the Sniffer VM &amp; Victim VM</li>
</ul>
<p class="image-container"><img style="width: 610.00px" src="../re101/img/f15e378ad6be24cd.png"></p>
<ul>
<li>On the <strong>Sniffer VM</strong> open the terminal and run <code>sudo wireshark</code> to get Wireshark sniffing the traffic from the Victim VM. In the menu select <strong>&#34;any&#34;</strong> for the interface to monitor. Be sure InetSim is still running, see the fundamentals section on how to start up InetSim.</li>
<li>On the <strong>Victim VM</strong> go to the <strong>Desktop-&gt;Tools-&gt;SysInternalsSuite </strong>and open <strong>procmon.exe</strong> and <strong>procexp.exe</strong> so that we can monitor filesystem and process events.</li>
<li>If you open internet explorer on the Victim Vm you should be able to see the InetSim test page.</li>
<li>You should see communication between IP addresses 10.10.10.111 (Victim) and 10.10.10.112 (Sniffer)</li>
</ul>
<p class="image-container"><img style="width: 610.00px" src="../re101/img/9332812880384b94.png"></p>
<h2 is-upgraded>Open a new windows cmd.exe terminal and run the Unknown.exe</h2>
<p class="image-container"><img style="width: 553.00px" src="../re101/img/bead8116f5e69683.png"></p>
<p>You should see an interesting popup in the Victim VM</p>
<p class="image-container"><img style="width: 159.00px" src="../re101/img/9c39436224e9ff94.png"></p>
<h2 is-upgraded>Look at network activity in Wireshark</h2>
<p>You should see some interesting network activity in Wireshark in the Sniffer VM.</p>
<p class="image-container"><img style="width: 610.00px" src="../re101/img/49d57783f45558b6.png"></p>
<p>In Wireshark, find the Protocol HTTP where the info contains <code>GET /l00k_wh4t_y0u_m4d3_m3_d0</code></p>
<p>Right click and Follow-&gt;TCP Stream. It will display the HTTP get request that was sent by the Unknown.exe</p>
<h2 is-upgraded>Stop the monitoring in procmon.exe</h2>
<p>Stop the monitoring in procmon.exe <strong>File-&gt;Capture Events</strong></p>
<ul>
<li>In procmon.exe you can filter</li>
<li><strong>[Process Name] [is] [Unknown.exe]</strong></li>
<li><strong>[Operation] [is] [CreateFile]</strong></li>
</ul>
<p>The filter should show that there was a file created in <code>C:\Users\victim\AppData\Roaming\stage2.exe</code></p>
<h2 is-upgraded>Summarize all the Details</h2>
<p>Summarize all the interesting details in your notes. You will use these details in the next section</p>
<p>So far the assumptions you can make:</p>
<ul>
<li>It might be starting a new process</li>
<li>It might be extracting something out from it&#39;s resources</li>
<li>It has an internet HTTP GET request to <code>definitely-not-evil.com/l00k_wh4t_y0u_m4d3_m3_d0</code></li>
<li>It creates a file called stage2.exe</li>
<li>It has a message box that says totally not malware</li>
</ul>


      </google-codelab-step>

      <google-codelab-step label="Lab 2: Stage1 Static Analysis" duration="25">
        <p>Static analysis is like reading a map for directions on where to go. As you follow through this map you capture notes on what things might look interesting when you actually begin your journey.</p>
<p>This section will teach you how to jump into code in static disassembly then rename and comment on interesting assembly routines that we will debug in the last section.</p>
<h2 is-upgraded>Open Unknown.exe in IDA</h2>
<p>You should see a control flow <strong>graph view</strong> of the start function. To see the <strong>text view</strong>, hit your space bar to toggle the views.</p>
<p class="image-container"><img style="width: 610.00px" src="../re101/img/c7451e7d6a233b69.png"></p>
<p class="image-container"><img style="width: 610.00px" src="../re101/img/db2c0af1608362ad.png"></p>
<h2 is-upgraded>String Anti Analysis</h2>
<p>Notice that the function is using many push instructions. This is a technique used by malware authors to hide strings on the stack. Remember that values are in little endian format so each Hex value will appear backwards.</p>
<ul>
<li>Right click on the value of one of those pushes (i.e. <code>67616C66h</code>) and select the R for the readable string option.</li>
<li><code>67616C66h</code> will be <code>galf</code> in ascii text</li>
<li>Convert all the values of all the sequential pushes from offset <code>00401151</code> to <code>00401188</code></li>
<li>This will be our first Flag</li>
</ul>
<h2 is-upgraded>Next, go to the <strong>Strings Tab</strong></h2>
<ul>
<li>Look for interesting strings you recognize from the triage analysis. For example let&#39;s use stage2.exe</li>
<li>Double click on the string stage2.exe and it will take you to where the string exists in the executable image</li>
<li>Now you will need to find out which code is referencing this string. Place your cursor on it&#39;s reference label <code>aStage_exe</code> and hit the <strong>X</strong> key. This will open a window that will show all of the code locations that reference this string.</li>
<li>In the xrefs menu, select the address to <code>sub_401000</code>. This will take you to where the string is referenced at <code>004010B0</code>.</li>
</ul>
<p class="image-container"><img style="width: 610.00px" src="../re101/img/60128830aaa1663e.gif"></p>
<h2 is-upgraded>Trace back to the Start function</h2>
<p>You will need to create record the route from the start function to the current position you are at. To do this you will need to follow the xrefs of the functions backwards until you reach the start function.</p>
<ul>
<li>In the text view, scroll up to the first location label <code>loc_40104C</code>. Place cursor on the function name and hit the<strong> X</strong> key to follow the code which branches to this location (A branch or jump instruction is jbe or jmp).</li>
<li>Keep doing this until you reach the beginning of the current function which is at offset <code>00401000</code>.</li>
<li>You will need to keep track of where these branch statements occur as apart of the flow.</li>
<li>Place cursor on the function name and hit the <strong>X</strong> key. Select the first function you see which is the Start function.</li>
</ul>
<p class="image-container"><img style="width: 610.00px" src="../re101/img/86cb0649a099d931.gif"></p>


<h2 is-upgraded>Analyze function sub_401000</h2>
<p>So it looks like you need to capture when stage2.exe file is created and written. Remember that functions have their arguments pushed onto the stack before the function is called.</p>
<p>In the excerpt below, the string for stage2.exe is concatenated together with the string referenced by the register esi. Then esi is used as the first argument for <code>CreateFileA</code>.</p>
<h3 is-upgraded>C function</h3>
<pre><code>HANDLE CreateFileA(
 LPCSTR                lpFileName, // Arg1
 DWORD                 dwDesiredAccess, // Arg2
 DWORD                 dwShareMode, //Arg3
 LPSECURITY_ATTRIBUTES lpSecurityAttributes, //Arg4
 DWORD                 dwCreationDisposition, //Arg5
 DWORD                 dwFlagsAndAttributes, //Arg6
 HANDLE                hTemplateFile //Arg7
);</code></pre>
<h3 is-upgraded>Assembly</h3>
<pre><code>.text:004010B0                 push    offset aStage2_exe ; &#34;stage2.exe&#34;
.text:004010B5                 push    esi             ; lpString1
.text:004010B6                 call    edi ; lstrcatA
.text:004010B8                 push    0               ; Arg7 hTemplateFile
.text:004010BA                 push    80h             ; Arg6
.text:004010BF                 push    2               ; Arg5
.text:004010C1                 push    0               ; Arg4
.text:004010C3                 push    0               ; Arg3 dwShareMode
.text:004010C5                 push    40000000h       ; Arg2 dwDesiredAccess
.text:004010CA                 push    esi             ; Arg1 lpFileName
.text:004010CB                 call    ds:CreateFileA</code></pre>
<p>Also notice further down the function, the esi register containing the new string is used as an argument for a call to <code>CreateProcessA</code>. Remember you saw this function in the executable header imports.</p>
<p>Other interesting API function patterns:</p>
<ul>
<li>Opening a file from the resource section</li>
<li>FindResource</li>
<li>SizeofResource</li>
<li>LoadResource</li>
<li>LockResource</li>
<li>Creating a file</li>
<li>GetEnvironmentVariable</li>
<li>CreateFile</li>
<li>WriteFile</li>
<li>CloseHandle</li>
<li>Sleep</li>
<li>Starting a new process</li>
<li>CreateProcess</li>
</ul>
<p>Now you know how to navigate the disassembly forward and backwards to get to interesting routines using control flow instruction (branch, jumps, calls).</p>
<p class="image-container"><img style="width: 482.00px" src="../re101/img/8a06df0596e48096.jpeg"></p>


      </google-codelab-step>

      <google-codelab-step label="Lab 2: Stage2 Static Analysis" duration="30">
        <p>The next step is making a rough path to follow for deeper analysis in the next section.</p>
<h2 is-upgraded>Collect stage2.exe</h2>
<p>Collect <code>C:\Users\victim\AppData\Roaming\stage2.exe</code> and open it in IDA to analyze.</p>
<h2 is-upgraded>Look for interesting strings</h2>
<p>In IDA, go to the strings tab and look for interesting strings. You should see <code>l00k_wh4t_y0u_m4d3_m3_d0</code> referenced. Similar to the first executable, follow that string to the code location it&#39;s being referenced at <code>00401065</code></p>
<p>Can you guess what this function is doing?</p>
<h2 is-upgraded>Trace the function back to start and record the path</h2>
<h2 is-upgraded>Recognizing Buffers</h2>
<p>The string <code>l00k_wh4t_y0u_m4d3_m3_d0</code> was used in function sub_401000 where it was doing the HTTP request. However a buffer was an argument to this function. Unlike the instruction <code>push, lea     &lt;reg&gt;, &lt;some address&gt;</code> is another way to add arguments. The register <code>edi</code> stores the address of the buffer.</p>
<p>The excerpt below shows this buffer being given to <code>sub_401000</code>. That same buffer is being compared against 6Ch</p>
<pre><code>.text:00401169                 lea     edi, [ebp-104h]
.text:0040116F                 mov     byte ptr [ebp-104h], 0
.text:00401176                 call    sub_401000
.text:0040117B                 cmp     byte ptr [ebp-104h], 6Ch</code></pre>
<h2 is-upgraded>HTTP request result</h2>
<p>So you know that <code>edi</code> contains the address of the buffer. That buffer is given to InternetReadFile so when the response data from <code>definitely-not-evil.com/l00k_wh4t_y0u_m4d3_m3_d0</code>  will be placed into the buffer</p>
<pre><code>.text:00401104                 push    eax             ; lpdwNumberOfBytesRead
.text:00401105                 push    0FEh            ; dwNumberOfBytesToRead
.text:0040110A                 push    edi             ; lpBuffer
.text:0040110B                 push    esi             ; hFile
.text:0040110C                 mov     [ebp+dwNumberOfBytesRead], 0
.text:00401116                 call    ebx ; InternetReadFile</code></pre>
<h2 is-upgraded>Buffer Check</h2>
<p>The resulting buffer will contain bytes that will be compared against <code>6Ch, 6Dh, 61h, 6Fh</code></p>
<pre><code>.text:00401176                 call    sub_401000
.text:0040117B                 cmp     byte ptr [ebp-104h], 6Ch
.text:00401182                 jnz     loc_4012E6
.text:00401188                 cmp     byte ptr [ebp-103h], 6Dh
.text:0040118F                 jnz     loc_4012E6
.text:00401195                 cmp     byte ptr [ebp-102h], 61h
.text:0040119C                 jnz     loc_4012E6
.text:004011A2                 cmp     byte ptr [ebp-101h], 6Fh
.text:004011A9                 jnz     loc_4012E6
.text:004011AF                 mov     edi, ds:LoadIconA</code></pre>
<p>Here is the pseudo code of the assembly</p>
<pre><code>if (buffer[0] != 6C) goto Exit
if (buffer[1] != 6D) goto Exit
if (buffer[2] != 61) goto Exit
if (buffer[3] != 6F) goto Exit</code></pre>
<p>If you follow the address of the branching jump instruction, it will take you to the exit of the program. But this is not what you want. You will need to bypass these branch statements in order to see what happens after it received the HTTP response.</p>
<p>This is the part of the program that we will need to control from a debugger in the next section<strong>.</strong></p>
<p class="image-container"><img style="width: 380.15px" src="../re101/img/7fc4459ca2c429cc.jpeg"></p>


      </google-codelab-step>

      <google-codelab-step label="Lab 3: Dynamic Analysis" duration="30">
        <p>Dynamic analysis is a deeper analysis of the program to understand hidden functionality not understood statically. The static analysis will serve as a guide for stepping through the program in a debugger.</p>
<p>Open the stage2.exe into the x32dbg.exe (referred as x64dbg) debugger and IDAfree.</p>
<p>Remember use the F2(breakpoint), F7(Step Into), F8(Step Over), F9(Run) keys to navigate through the debugger. If you accidentally run past the end the of the program you can always restart by clicking .</p>
<p class="image-container"><img style="width: 610.00px" src="../re101/img/1c6fb8f9bd4bda8.png"></p>
<h2 is-upgraded>Getting to EntryPoint</h2>
<p>In x32dbg.exe, run to the entry point by pressing the right arrow in the top menu or <strong>Debug-&gt;Run.</strong></p>
<p>The debugger should land you at the start function <code>00401150 </code></p>
<h2 is-upgraded>Setting Breakpoints</h2>
<p>You can set breakpoint by clicking on the dot next to the address in the disassembly view or enter bp &lt;your address in hex&gt; in the command window.</p>
<ul>
<li>Set a break point on the jne instruction after <code>sub_00401000</code> at <code>00401182</code>. Hit run.</li>
</ul>
<p class="image-container"><img style="width: 610.00px" src="../re101/img/263eb385dd949c8c.gif"></p>

<h3 is-upgraded>Manipulating the Control Flow</h3>
<p>We want to manipulate the control flow instructions so that we can get to the code after the buffer check. Continue to step to the <strong>jne</strong> (jump if not equal) instruction. By double clicking the <strong>ZF flag</strong> we can manipulate the result 1 to 0.</p>
<p class="image-container"><img style="width: 610.00px" src="../re101/img/2a6e5f4d3cefe899.gif"></p>

<p>By knowing what the executable is expecting, you will be able to create a fake server that send the information it&#39;s looking for. Many RATs (Remote Access Trojans) and bots rely on specific responses in order to perform their duties. By reversing them, you can recreate the response data.</p>
<h2 is-upgraded>Run the program</h2>
<p>Once you have bypassed those 4 branch jump instructions, go ahead and run the rest of the program to collect the last Flag.</p>
<h2 is-upgraded>Summarize the functionality</h2>
<p>As a malware analyst, it&#39;s your job to summarize the functionality and relationships of the binaries.</p>
<p>Here is a brief summary of what is happening.</p>
<ol type="1" start="1">
<li>Unknown.exe will load the first flag in the stack</li>
<li>It will then extract a file from resources and create stage2.exe in <code>%APPDATA%</code> folder</li>
<li>It will run stage2.exe as a new process</li>
<li>stage2.exe will call out to <code>definitely-not-evil.com/l00k_wh4t_y0u_m4d3_m3_d0</code> and wait to see lmao as the response</li>
<li>It will then create a new message box that contains an image with the second flag</li>
</ol>


      </google-codelab-step>

  </google-codelab>

  <script src="../pkg/native-shim.js"></script>
  <script src="../pkg/custom-elements.min.js"></script>
  <script src="../pkg/prettify.js"></script>
  <script src="../pkg/codelab-elements.js"></script>


</body>
</html>
